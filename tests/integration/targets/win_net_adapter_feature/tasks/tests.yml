# Below are the cases tested Windows Server 2016 with network adapters('Etherner0' and 'Ethernet1)
---
############################################
### Abnormal tests ###
############################################

- name: fail when interface isn't set
  ansible.windows.win_net_adapter_feature:
    state: enabled
    component_id: ms_tcpip6
  ignore_errors: yes

- name: fail when component_id isn't set
  ansible.windows.win_net_adapter_feature:
    interface: 'Ethernet0'
    state: enabled
  ignore_errors: yes

- name: fail when interface doesn't exist
  ansible.windows.win_net_adapter_feature:
    interface: 'Ethernet10'
    state: enabled
    component_id: ms_tcpip6
  ignore_errors: yes

- name: fail when state is inapppropriate
  ansible.windows.win_net_adapter_feature:
    interface: 'Ethernet0'
    state: disabled_inappropriate
    component_id: ms_tcpip6
  ignore_errors: yes

- name: fail when component_id is inapppropriate
  ansible.windows.win_net_adapter_feature:
    interface: 'Ethernet0'
    state: disabled
    component_id: inappropriate_component
  ignore_errors: yes

############################################
### Normal tests ###
############################################
- name: disable ms_tcpip6 of Ethernet0 before execution of normal tests.
  win_shell: 'Disable-NetAdapterBinding -Name Ethernet0 -ComponentID ms_tcpip6'

- name: get the status of ms_tcpip6 of Ethernet0 before execution of normal tests.
  win_shell: (Get-NetAdapterBinding -Name Ethernet0 -ComponentID ms_tcpip6).Enabled
  register: before_normal_tests

- name: assert that the status of ms_tcpip6 is 'disabled' before execution of normal tests.
  assert:
    that:
      - "{{ before_normal_tests.stdout_lines[0] == 'False' }}"

############################################
### Normal tests1 ###
############################################

- name: enable an interface of ms_tpip6 when state isn't set (because the default state is 'enabled')
  ansible.windows.win_net_adapter_feature:
    interface: 'Ethernet0'
    component_id: ms_tcpip6
  register: normal_test1

- name: get the status of ms_tcpip6 of Ethernet0 after executing normal_test1.
  win_shell: (Get-NetAdapterBinding -Name Ethernet0 -ComponentID ms_tcpip6).Enabled
  register: normal_test1_status

- name: assert that changed is true and the status turns 'enabled'.
  assert:
    that:
      - normal_test1 is changed
      - "{{ normal_test1_status.stdout_lines[0] == 'True' }}"

############################################
### Normal tests2 (checking idempotency) ###
############################################
- name: enable an interface of ms_tcpip6
  ansible.windows.win_net_adapter_feature:
    interface: 'Ethernet0'
    state: enabled
    component_id: ms_tcpip6
  register: normal_test2

- name: get the status of ms_tcpip6 of Ethernet0 after executing normal_test2.
  win_shell: (Get-NetAdapterBinding -Name Ethernet0 -ComponentID ms_tcpip6).Enabled
  register: normal_test2_status

- name: assert that changed is false and the status is still remained 'enabled'.
  assert:
    that:
      - normal_test2 is not changed
      - "{{ normal_test2_status.stdout_lines[0] == 'True' }}"

############################################
### Normal tests3 ###
############################################
- name: disable an interface of ms_tcpip6
  ansible.windows.win_net_adapter_feature:
    interface: 'Ethernet0'
    state: disabled
    component_id: ms_tcpip6
  register: normal_test3

- name: get the status of ms_tcpip6 of Ethernet0 after executing normal_test3.
  win_shell: (Get-NetAdapterBinding -Name Ethernet0 -ComponentID ms_tcpip6).Enabled
  register: normal_test3_status

- name: assert that changed is true and the status turns 'disabled'.
  assert:
    that:
      - normal_test3 is changed
      - "{{ normal_test3_status.stdout_lines[0] == 'False' }}"

############################################
### Normal tests4 ###
############################################
- name: enable all the interfaces of ms_tcpip6
  ansible.windows.win_net_adapter_feature:
    interface: '*'
    state: enabled
    component_id: ms_tcpip6
  register: normal_test4

- name: get the status of ms_tcpip6 of Ethernet0 after executing normal_test4.
  win_shell: (Get-NetAdapterBinding -Name * -ComponentID ms_tcpip6).Enabled
  register: normal_test4_status

- name: assert that changed is true and each status turns 'enabled'.
  assert:
    that:
      - normal_test4 is changed
      - "{{ normal_test4_status.stdout_lines[0] == 'True' }}"
      - "{{ normal_test4_status.stdout_lines[1] == 'True' }}"

############################################
### Normal tests5 ###
############################################
- name: disable all the interfaces of ms_tcpip6
  ansible.windows.win_net_adapter_feature:
    interface: '*'
    state: disabled
    component_id: ms_tcpip6
  register: normal_test5

- name: get the status of ms_tcpip6 of Ethernet0 after executing normal_test5.
  win_shell: (Get-NetAdapterBinding -Name * -ComponentID ms_tcpip6).Enabled
  register: normal_test5_status

- name: assert that changed is true and each status turns 'disabled'.
  assert:
    that:
      - normal_test5 is changed
      - "{{ normal_test5_status.stdout_lines[0] == 'False' }}"
      - "{{ normal_test5_status.stdout_lines[1] == 'False' }}"

############################################
### Normal tests6 ###
############################################
- name: enable single component_id of multiple interface
  ansible.windows.win_net_adapter_feature:
    interface:
    - 'Ethernet0'
    - 'Ethernet1'
    state: enabled
    component_id: ms_tcpip6
  register: normal_test6

- name: get the status of ms_tcpip6 of Ethernet0 after executing normal_test6.
  win_shell: (Get-NetAdapterBinding -Name Ethernet0 -ComponentID ms_tcpip6).Enabled
  register: normal_test6_Ethernet0_status

- name: get the status of ms_tcpip6 of Ethernet1 after executing normal_test6.
  win_shell: (Get-NetAdapterBinding -Name Ethernet1 -ComponentID ms_tcpip6).Enabled
  register: normal_test6_Ethernet1_status

- name: assert that changed is true and each status turns 'enabled'.
  assert:
    that:
      - normal_test6 is changed
      - "{{ normal_test6_Ethernet0_status.stdout_lines[0] == 'True' }}"
      - "{{ normal_test6_Ethernet1_status.stdout_lines[0] == 'True' }}"

############################################
### Normal tests7 ###
############################################
- name: disable multiple component_id of an interface 
  ansible.windows.win_net_adapter_feature:
    interface:
    - 'Ethernet0'
    state: disabled
    component_id:
    - ms_tcpip6
    - ms_server
  register: normal_test7

- name: get the status of ms_tcpip6 of Ethernet0 after executing normal_test7.
  win_shell: (Get-NetAdapterBinding -Name Ethernet0 -ComponentID ms_tcpip6).Enabled
  register: normal_test7_ms_tcpip6_status

- name: get the status of ms_server of Ethernet0 after executing normal_test7.
  win_shell: (Get-NetAdapterBinding -Name Ethernet0 -ComponentID ms_server).Enabled
  register: normal_test7_ms_server_status

- name: assert that changed is true and each status turns 'disabled'.
  assert:
    that:
      - normal_test7 is changed
      - "{{ normal_test7_ms_tcpip6_status.stdout_lines[0] == 'False' }}"
      - "{{ normal_test7_ms_server_status.stdout_lines[0] == 'False' }}"

############################################
### Normal tests8 ###
############################################
- name: enable multiple interfaces of multiple interfaces
  ansible.windows.win_net_adapter_feature:
    interface:
    - 'Ethernet0'
    - 'Ethernet1'
    state: enabled
    component_id:
    - ms_tcpip6
    - ms_server
  register: normal_test8

- name: get the status of ms_tcpip6 of Ethernet0 after executing normal_test8.
  win_shell: (Get-NetAdapterBinding -Name Ethernet0 -ComponentID ms_tcpip6).Enabled
  register: normal_test8_Ethernet0_ms_tcpip6_status

- name: get the status of ms_server of Ethernet0 after executing normal_test8.
  win_shell: (Get-NetAdapterBinding -Name Ethernet0 -ComponentID ms_server).Enabled
  register: normal_test8_Ethernet0_ms_server_status

- name: get the status of ms_tcpip6 of Ethernet1 after executing normal_test8.
  win_shell: (Get-NetAdapterBinding -Name Ethernet1 -ComponentID ms_tcpip6).Enabled
  register: normal_test8_Ethernet1_ms_tcpip6_status

- name: get the status of ms_server of Ethernet1 after executing normal_test8.
  win_shell: (Get-NetAdapterBinding -Name Ethernet1 -ComponentID ms_server).Enabled
  register: normal_test8_Ethernet1_ms_server_status

- name: assert that changed is true and each status turns 'enabled'.
  assert:
    that:
      - normal_test8 is changed
      - "{{ normal_test8_Ethernet0_ms_tcpip6_status.stdout_lines[0] == 'True' }}"
      - "{{ normal_test8_Ethernet0_ms_server_status.stdout_lines[0] == 'True' }}"
      - "{{ normal_test8_Ethernet1_ms_tcpip6_status.stdout_lines[0] == 'True' }}"
      - "{{ normal_test8_Ethernet1_ms_server_status.stdout_lines[0] == 'True' }}"

############################################
### Normal tests9 (checking idempotency) ###
############################################

- name: enable multiple interfaces of multiple interfaces
  ansible.windows.win_net_adapter_feature:
    interface:
    - 'Ethernet0'
    - 'Ethernet1'
    state: enabled
    component_id:
    - ms_tcpip6
    - ms_server
  register: normal_test9

- name: get the status of ms_tcpip6 of Ethernet0 after executing normal_test9.
  win_shell: (Get-NetAdapterBinding -Name Ethernet0 -ComponentID ms_tcpip6).Enabled
  register: normal_test9_Ethernet0_ms_tcpip6_status

- name: get the status of ms_server of Ethernet0 after executing normal_test9.
  win_shell: (Get-NetAdapterBinding -Name Ethernet0 -ComponentID ms_server).Enabled
  register: normal_test9_Ethernet0_ms_server_status

- name: get the status of ms_tcpip6 of Ethernet1 after executing normal_test9.
  win_shell: (Get-NetAdapterBinding -Name Ethernet1 -ComponentID ms_tcpip6).Enabled
  register: normal_test9_Ethernet1_ms_tcpip6_status

- name: get the status of ms_server of Ethernet1 after executing normal_test9.
  win_shell: (Get-NetAdapterBinding -Name Ethernet1 -ComponentID ms_server).Enabled
  register: normal_test9_Ethernet1_ms_server_status

- name: assert that changed is false and each status is still remained 'enabled'.
  assert:
    that:
      - normal_test9 is not changed
      - "{{ normal_test9_Ethernet0_ms_tcpip6_status.stdout_lines[0] == 'True' }}"
      - "{{ normal_test9_Ethernet0_ms_server_status.stdout_lines[0] == 'True' }}"
      - "{{ normal_test9_Ethernet1_ms_tcpip6_status.stdout_lines[0] == 'True' }}"
      - "{{ normal_test9_Ethernet1_ms_server_status.stdout_lines[0] == 'True' }}"

############################################
### Check mode tests ###
############################################
- name: check mode(disable multiple interfaces of multiple interfaces)
  ansible.windows.win_net_adapter_feature:
    interface:
    - 'Ethernet0'
    - 'Ethernet1'
    state: disabled
    component_id:
    - ms_tcpip6
    - ms_server
  check_mode: yes
  register: check_mode_test1

- name: get the status of ms_tcpip6 of Ethernet0 after executing check_mode_test1.
  win_shell: (Get-NetAdapterBinding -Name Ethernet0 -ComponentID ms_tcpip6).Enabled
  register: check_mode_test1_Ethernet0_ms_tcpip6_status

- name: get the status of ms_server of Ethernet0 after executing check_mode_test1.
  win_shell: (Get-NetAdapterBinding -Name Ethernet0 -ComponentID ms_server).Enabled
  register: check_mode_test1_Ethernet0_ms_server_status

- name: get the status of ms_tcpip6 of Ethernet1 after executing check_mode_test1.
  win_shell: (Get-NetAdapterBinding -Name Ethernet1 -ComponentID ms_tcpip6).Enabled
  register: check_mode_test1_Ethernet1_ms_tcpip6_status

- name: get the status of ms_server of Ethernet1 after executing check_mode_test1.
  win_shell: (Get-NetAdapterBinding -Name Ethernet1 -ComponentID ms_server).Enabled
  register: check_mode_test1_Ethernet1_ms_server_status

- name: assert that changed is true and each status is still remained 'enabled'.
  assert:
    that:
      - check_mode_test1 is changed
      - "{{ check_mode_test1_Ethernet0_ms_tcpip6_status.stdout_lines[0] == 'True' }}"
      - "{{ check_mode_test1_Ethernet0_ms_server_status.stdout_lines[0] == 'True' }}"
      - "{{ check_mode_test1_Ethernet1_ms_tcpip6_status.stdout_lines[0] == 'True' }}"
      - "{{ check_mode_test1_Ethernet1_ms_server_status.stdout_lines[0] == 'True' }}"
